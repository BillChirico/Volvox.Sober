# Volvox.Sober Development Guidelines

Last updated: 2025-11-06

## Project Overview

Volvox.Sober is a universal Expo application (iOS, Android, Web) for sobriety support and recovery, enabling authentic peer accountability through curated sponsor/sponsee matching.

## Technology Stack

### Frontend (Universal App)

- **Platform**: Expo 54.x (universal app platform)
- **Framework**: React Native 0.81+
- **Language**: TypeScript 5.x (strict mode)
- **Navigation**: Expo Router 4.x (file-based routing)
- **State Management**: Redux Toolkit + Redux Persist
- **Form Handling**: Yup validation
- **UI**: React Native Paper with custom theme system
- **Testing**: Jest + React Native Testing Library + Playwright (E2E)
- **Authentication**: Supabase Auth SDK (@supabase/supabase-js)

### Backend (Supabase)

- **Database**: PostgreSQL 15+
- **Authentication**: Supabase Auth (GoTrue)
- **Real-time**: Supabase Realtime subscriptions
- **Functions**: Supabase Edge Functions (Node.js 18+ / Deno runtime)
- **Storage**: Row Level Security (RLS)

### Package Manager

- **pnpm**: 10.20.0 (monorepo workspace structure)

## Project Structure

```
volvox-sober/
├── app/                 # Expo Router (file-based routing)
│   ├── (tabs)/          # Tab navigation group
│   │   ├── _layout.tsx
│   │   ├── connections.tsx
│   │   ├── matches.tsx
│   │   ├── messages.tsx
│   │   ├── sobriety.tsx
│   │   └── profile.tsx
│   ├── (auth)/          # Auth screens group
│   │   ├── _layout.tsx
│   │   ├── login.tsx
│   │   ├── signup.tsx
│   │   ├── forgot-password.tsx
│   │   └── verify-email.tsx
│   ├── (onboarding)/    # Onboarding screens group
│   │   ├── _layout.tsx
│   │   ├── welcome.tsx
│   │   ├── email-verification.tsx
│   │   ├── sponsor-profile.tsx
│   │   └── sponsee-profile.tsx
│   ├── _layout.tsx      # Root layout with providers
│   ├── index.tsx        # Entry route (redirect logic)
│   └── +not-found.tsx   # 404 page
│
├── src/                 # Application source code
│   ├── components/      # Reusable UI components
│   │   ├── auth/        # Authentication-specific components
│   │   └── common/      # Shared components (AccessibleButton, etc.)
│   ├── services/        # API clients, business logic
│   │   ├── authService.ts # Supabase Auth integration
│   │   └── validationSchemas.ts # Yup validation schemas
│   ├── store/           # State management (Redux Toolkit)
│   │   └── auth/        # Auth state slice, selectors, thunks
│   ├── types/           # TypeScript definitions
│   │   └── auth.ts      # Authentication types
│   ├── hooks/           # Custom React hooks
│   │   ├── useAuth.ts   # Auth operations hook
│   │   └── useAuthRedirect.ts # Navigation hook
│   ├── theme/           # Theme tokens and provider
│   ├── constants/       # App constants (Colors, Layout)
│   └── utils/           # Utility functions
│       └── passwordStrength.ts # Password strength calculator
│
├── __tests__/           # Test files
├── assets/              # Images, fonts, static resources
├── ios/                 # iOS native code (generated by Expo)
├── android/             # Android native code (generated by Expo)
├── web/                 # Web-specific code and configuration
├── e2e/                 # End-to-end tests (Detox)
│
├── packages/
│   └── shared/          # Shared code (types, utilities)
│       └── types/       # TypeScript type definitions
│
├── supabase/            # Backend
│   ├── migrations/      # Database schema migrations
│   ├── functions/       # Edge Functions
│   └── seed.sql         # Test data seeding
│
├── specs/               # Feature specifications & planning
│   └── 001-auth-screens/
│       ├── spec.md      # Feature specification
│       ├── plan.md      # Implementation plan
│       ├── research.md  # Technical decisions
│       ├── data-model.md # Database design
│       ├── quickstart.md # Local development guide
│       ├── contracts/   # API contract specifications
│       │   ├── auth.yaml # Supabase Auth contracts
│       │   └── README.md
│       └── tasks.md     # Work packages (generated by /speckit.tasks)
│
├── docs/                # Project documentation
└── scripts/             # Build and utility scripts
```

### Platform-Specific Files

Expo supports platform-specific implementations:

- `Component.tsx` - Shared across all platforms
- `Component.ios.tsx` - iOS-specific override
- `Component.android.tsx` - Android-specific override
- `Component.web.tsx` - Web-specific override

### Important: Screen Organization

**All screen components MUST be in the `app/` directory using Expo Router's file-based routing.**

- ✅ **Correct**: Create screens in `app/(tabs)/`, `app/(auth)/`, `app/(onboarding)/`, etc.
- ❌ **Incorrect**: DO NOT create screens in `src/screens/` (deprecated)
- The `src/` directory is for reusable components, services, hooks, and utilities only
- Screens in `app/` use Expo Router's automatic routing based on file structure

## Commands

### Development

```bash
# Start Expo dev server
pnpm start

# Run on iOS
pnpm ios

# Run on Android
pnpm android

# Run on Web
pnpm web
```

### Quality Checks

```bash
# Run all tests
pnpm test

# Type checking
pnpm typecheck

# Linting
pnpm lint
pnpm lint:fix

# Code formatting
pnpm format
```

## Code Style

### TypeScript

- **Strict mode enabled**: No implicit any, strict null checks
- **Interfaces over types**: Prefer interface for object shapes
- **Explicit return types**: For all exported functions
- **No `any`**: Use `unknown` or proper types

### React Native

- **Functional components**: Use hooks, no class components
- **Named exports**: Prefer named exports over default
- **Component structure**: Props interface → Component → Styles
- **Hooks order**: useState → useEffect → custom hooks → handlers

### File Naming

- **Components**: PascalCase (`Button.tsx`, `UserProfile.tsx`)
- **Hooks**: camelCase with `use` prefix (`useAuth.ts`)
- **Services**: camelCase (`authService.ts`, `messageService.ts`)
- **Types**: PascalCase (`User.ts`, `Message.ts`)
- **Tests**: Mirror source with `.test.tsx` suffix

### Testing

- **Unit tests**: Jest + React Native Testing Library
- **E2E tests**: Playwright (web testing and automation)
- **Coverage target**: 80% minimum for business logic
- **Test location**: Co-located `__tests__` directories
- **TDD Required**: Write tests first, verify failure, implement, verify pass, refactor

## Development Workflow

1. **Branch from main**: Create feature branch from `main`
2. **Follow TDD**: Write tests first for new features
3. **Type safety**: Ensure TypeScript strict mode compliance
4. **Quality checks**: Always run in this order when editing or adding files:
   ```bash
   pnpm lint:fix    # Linting with auto-fix (includes Prettier formatting)
   pnpm typecheck   # TypeScript validation
   pnpm test        # Run test suite
   ```
5. **Commit and push**: After completing all tasks, commit changes and push to remote
6. **Commit messages**: Conventional commits with scope (feat(scope):, fix(scope):, docs(scope):, etc.)

## Environment Setup

1. **Node.js**: 18.0.0 or higher
2. **pnpm**: 8.0.0 or higher
3. **Expo CLI**: Installed automatically with dependencies
4. **iOS**: Xcode 14+ (macOS only)
5. **Android**: Android Studio + SDK 33+
6. **Web**: Modern browser (Chrome, Firefox, Safari, Edge)

Copy `.env.example` to `.env` and configure environment variables.

## Key Memories

Project has documented memories for:

- `project_overview`: Core features and technical stack
- `codebase_structure`: Directory layout and patterns
- `tdd_workflow`: Test-driven development approach
- `code_style_conventions`: Coding standards
- `task_completion_checklist`: Pre-commit checklist
- `constitution`: Project-wide quality standards and principles

## Constitution Principles

Six core principles govern all development (see `.specify/memory/constitution.md`):

1. **Type Safety & Code Quality**: TypeScript strict mode, no `any`, explicit return types
2. **Test-Driven Development**: TDD mandatory, 80% coverage, RED-GREEN-REFACTOR cycle
3. **Cross-Platform UX Consistency**: WCAG 2.1 AA, React Native Paper, accessibility-first
4. **Performance Standards**: <3s startup, 60 FPS, bundle size limits
5. **Component Architecture**: Functional components, hooks order, state management hierarchy
6. **Security & Privacy**: Supabase Auth only, RLS enabled, dual validation (client + server)

## Current Status

- **Phase**: Phase 10 - Polish & Cross-Cutting Concerns (Final Phase)
- **Active Feature**: `002-app-screens` (App Screen Implementation)
- **Active Branch**: `002-app-screens`
- **Completed Work**:
  - ✅ Project setup with Expo Router file-based routing
  - ✅ Authentication screens in app/(auth)/
  - ✅ Onboarding screens in app/(onboarding)/
  - ✅ Tab navigation screens in app/(tabs)/
  - ✅ Core components, hooks, and services
  - ✅ State management with Redux Toolkit + Redux Persist
  - ✅ Real-time messaging with Supabase subscriptions
  - ✅ Profile management with role switching
  - ✅ Settings screens (notifications, theme, account)
  - ✅ Accessibility testing (Playwright E2E + manual checklists)
  - ✅ Dark mode with Material Design 3 theming
  - ✅ Comprehensive E2E test coverage (9 Playwright test suites)
  - ✅ Performance optimizations (image lazy loading, list virtualization)
  - ✅ Error handling (ErrorBoundary, ErrorMessage, NetworkIndicator)
- **Current Focus**: Final validation and documentation
- **Note**: All screen components now reside in app/ directory using Expo Router. The old src/screens/ directory is deprecated and should not be used.

## MCP Server Usage

**MANDATORY**: MCP servers MUST be used whenever applicable. Using native tools when an MCP server is available is a project standards violation.

### Quick Decision Matrix

```
Task Type → MCP Server (USE THESE):
├─ Database/Auth/Edge Functions → Supabase MCP (mcp__supabase__*)
├─ Code symbols/navigation/memory → Serena MCP (mcp__serena__*)
├─ Complex reasoning/analysis → Sequential MCP (mcp__sequential-thinking__*)
├─ Session/context management → Memory Keeper MCP (mcp__memory-keeper__*)
├─ GitHub operations → GitHub MCP (mcp__github__*)
├─ Web research/search → Tavily MCP (mcp__tavily__*) or Brave MCP (mcp__brave__*)
├─ UI components → Shadcn MCP (mcp__shadcn__*)
├─ VS Code diagnostics → IDE MCP (mcp__ide__*)
├─ Fast code edits → Morphllm MCP (mcp__morphllm__*)
└─ Enhanced web fetch → Fetch MCP (mcp__fetch__*)
```

### Core MCPs for This Project

#### 1. **Supabase MCP** (`mcp__supabase__*`)
**Use for**: Database migrations, schema changes, Auth configuration, Edge Functions, RLS policies

```typescript
// Database operations
mcp__supabase__apply_migration      // Create/apply migrations
mcp__supabase__execute_sql          // Run SQL queries
mcp__supabase__list_tables          // View schema
mcp__supabase__get_logs             // Check service logs

// Edge Functions
mcp__supabase__deploy_edge_function // Deploy functions
mcp__supabase__list_edge_functions  // View deployed functions

// Development branches
mcp__supabase__create_branch        // Create dev branch
mcp__supabase__merge_branch         // Merge to production
```

**Triggers**: `migration`, `database`, `schema`, `supabase auth`, `edge function`, `RLS`, `postgres`, `query`

#### 2. **Serena MCP** (`mcp__serena__*`)
**Use for**: Symbol operations, code navigation, project memory, refactoring

```typescript
// Symbol operations
mcp__serena__find_symbol               // Find symbols in codebase
mcp__serena__find_referencing_symbols  // Find all usages
mcp__serena__rename_symbol             // Rename across files
mcp__serena__get_symbols_overview      // File symbol overview

// Code editing
mcp__serena__replace_symbol_body       // Replace function/class body
mcp__serena__insert_after_symbol       // Add code after symbol
mcp__serena__insert_before_symbol      // Add code before symbol

// Project memory
mcp__serena__write_memory              // Store project knowledge
mcp__serena__read_memory               // Retrieve knowledge
mcp__serena__list_memories             // View all memories

// Code search
mcp__serena__search_for_pattern        // Regex search in code
```

**Triggers**: `rename`, `find references`, `symbol`, `refactor`, `project memory`, `architecture`

#### 3. **Sequential Thinking MCP** (`mcp__sequential-thinking__*`)
**Use for**: Complex reasoning, architectural analysis, root cause investigation

```typescript
mcp__sequential-thinking__sequentialthinking({
  thought: "Current analysis step",
  thoughtNumber: 1,
  totalThoughts: 5,
  nextThoughtNeeded: true
})
```

**Triggers**: `--think`, `--think-hard`, `--ultrathink`, complex debugging, architecture decisions, multi-component analysis

**Complexity levels**:
- `--think`: 3-5 interconnected components (~4K tokens)
- `--think-hard`: Architectural analysis (~10K tokens)
- `--ultrathink`: Critical system redesign (~32K tokens)

#### 4. **Memory Keeper MCP** (`mcp__memory-keeper__*`)
**Use for**: Session management, context persistence, checkpoints

```typescript
// Session management
mcp__memory-keeper__context_session_start    // Start new session
mcp__memory-keeper__context_session_list     // List sessions
mcp__memory-keeper__context_save             // Save context item
mcp__memory-keeper__context_get              // Retrieve context

// Checkpoints
mcp__memory-keeper__context_checkpoint       // Create checkpoint
mcp__memory-keeper__context_restore_checkpoint // Restore state

// Search and analysis
mcp__memory-keeper__context_search           // Search context
mcp__memory-keeper__context_timeline         // View activity timeline
```

**Triggers**: Session persistence, context management, checkpoints, cross-session learning

#### 5. **GitHub MCP** (`mcp__github__*`)
**Use for**: Repository operations, PRs, issues, branches

```typescript
// Repository operations
mcp__github__create_branch           // Create feature branch
mcp__github__create_or_update_file   // Update files
mcp__github__push_files              // Batch file updates

// Pull requests
mcp__github__create_pull_request     // Create PR
mcp__github__update_pull_request     // Update existing PR
mcp__github__merge_pull_request      // Merge PR

// Issues
mcp__github__issue_read              // Read issue details
mcp__github__issue_write             // Create/update issue
mcp__github__add_issue_comment       // Comment on issue
```

**Triggers**: GitHub operations, PRs, issues, branches, commits

#### 6. **Tavily MCP** (`mcp__tavily__*`)
**Use for**: Web research, documentation search, current information

```typescript
mcp__tavily__search        // General web search
mcp__tavily__extract       // Extract content from URLs
mcp__tavily__crawl         // Deep website crawling
mcp__tavily__map           // Map website structure
```

**Triggers**: `search`, `research`, `latest`, `current`, `best practices`, `breaking changes`

#### 7. **Shadcn MCP** (`mcp__shadcn__*`)
**Use for**: UI component registry, shadcn/ui components

```typescript
mcp__shadcn__search_items_in_registries  // Search components
mcp__shadcn__view_items_in_registries    // View component details
mcp__shadcn__get_add_command_for_items   // Get install command
```

**Triggers**: UI components, shadcn, component registry

#### 8. **IDE MCP** (`mcp__ide__*`)
**Use for**: VS Code integration, diagnostics, code execution

```typescript
mcp__ide__getDiagnostics   // Get TypeScript/ESLint errors
mcp__ide__executeCode      // Run code in Jupyter kernel
```

**Triggers**: Diagnostics, type errors, lint errors, code execution

#### 9. **Morphllm MCP** (`mcp__morphllm__*`)
**Use for**: Fast code edits, pattern-based transformations

```typescript
mcp__morphllm__edit_file   // Fast pattern-based edits
```

**Triggers**: Bulk edits, pattern transformations, style enforcement

#### 10. **Fetch MCP** (`mcp__fetch__*`)
**Use for**: Enhanced web fetching with image support

```typescript
mcp__fetch__imageFetch({
  url: "https://example.com",
  images: true,
  text: { maxLength: 20000 }
})
```

**Triggers**: Web fetching, image extraction, screenshot capture

### MCP Integration Patterns

```
Common workflows combining MCPs:

1. Feature Development:
   Serena (analyze) → Sequential (plan) → Supabase (database) → Morphllm (code) → Memory Keeper (checkpoint)

2. Bug Investigation:
   Sequential (analyze) → Serena (find symbols) → IDE (diagnostics) → Supabase (query DB)

3. Refactoring:
   Serena (find references) → Sequential (plan) → Morphllm (apply changes) → IDE (verify)

4. Research & Implementation:
   Tavily (research) → Sequential (analyze) → Serena (store insights) → Memory Keeper (save)

5. PR Creation:
   Serena (review changes) → GitHub (create branch) → GitHub (push files) → GitHub (create PR)
```

### MCP Selection Rules

**ALWAYS use MCP when**:
- ✅ Operating on Supabase (database, auth, functions)
- ✅ Symbol operations (rename, find references)
- ✅ Complex analysis (3+ components)
- ✅ Session/context management
- ✅ GitHub operations
- ✅ Web research/search
- ✅ Bulk code transformations (3+ files)

**NEVER use native tools when MCP exists**:
- ❌ Don't use Grep when Serena can find symbols
- ❌ Don't use multiple Edits when Morphllm can batch
- ❌ Don't use manual SQL when Supabase MCP exists
- ❌ Don't use WebSearch when Tavily is available
- ❌ Don't use manual GitHub CLI when GitHub MCP exists

### Enforcement

**Violation = Immediate Stop**:
1. Stop current operation
2. Acknowledge oversight
3. Restart with correct MCP

**Examples of violations**:
```
❌ "Find all uses of useAuth" → Using Grep instead of Serena
❌ "Create database migration" → Using manual SQL instead of Supabase MCP
❌ "Update 5 files with same pattern" → Using Edit instead of Morphllm
❌ "Research React Native performance" → Using native knowledge instead of Tavily
❌ "Create GitHub PR" → Using Bash git commands instead of GitHub MCP
```

<!-- MANUAL ADDITIONS START -->
<!-- MANUAL ADDITIONS END -->

## Active Technologies

- Expo Router 4.x (file-based routing) - 002-app-screens
- TypeScript 5.x (strict mode enabled) - 002-app-screens
- Redux Toolkit + Redux Persist - State management
- React Native Paper - UI component library
- Supabase - Backend (Auth, Database, Realtime)

## Recent Changes (002-app-screens branch)

### Screen Migration (Phase 1-9)

- ✅ **COMPLETED**: Full migration from React Navigation to Expo Router
- ✅ **DELETED** `src/screens/` directory - all 32 screens migrated to `app/`
- ✅ Authentication screens: login, signup, forgot-password, verify-email (app/(auth)/)
- ✅ Onboarding screens: welcome, role-selection, email-verification, profiles (app/(onboarding)/)
- ✅ Main tab screens: connections, matches, messages, sobriety, profile (app/(tabs)/)
- ✅ Connections sub-routes: [id], pending, send, sent (app/(tabs)/connections/)
- ✅ Messages sub-routes: [id] (app/(tabs)/messages/)
- ✅ Profile sub-routes: edit, view, change-role (app/(tabs)/profile/)
- ✅ Sobriety sub-routes: log-relapse, history, set-date (app/(tabs)/sobriety/)
- ✅ Steps sub-routes: index, work/[id], history (app/(tabs)/steps/)
- ✅ Check-ins sub-routes: response, schedule (app/(tabs)/check-ins/)
- ✅ Settings sub-routes: notifications, theme, account (app/(tabs)/settings/)
- ✅ Reviews sub-routes: sponsor (app/(tabs)/reviews/)

**Migration Status**: All screens converted from `useNavigation/useRoute` to `useRouter/useLocalSearchParams`

### Component Patterns (Phase 10)

**Profile Components** (src/components/profile/):

- `ProfileHeader.tsx`: Reusable profile header with avatar, name, role, and stats
  - Pattern: Composition with Material Design 3 Card and Surface
  - Features: Avatar display, user info, sobriety stats, action buttons
- `SettingsSection.tsx`: Themed settings section container
  - Pattern: Section header with divider, consistent spacing
  - Features: Icon support, nested List.Item integration
- `NotificationSettings.tsx`: Comprehensive notification preferences management
  - Pattern: Switch controls with descriptions, grouped by category
  - Features: Async state updates, loading indicators, accessibility labels

**Error Handling Components** (src/components/common/):

- `ErrorBoundary.tsx`: React error boundary with retry functionality
- `ErrorMessage.tsx`: Styled error display with retry actions
- `NetworkIndicator.tsx`: Connection status indicator with auto-hide

### State Management Patterns

**Redux Toolkit with RTK Query**:

- Pattern: Feature-based slices with colocated selectors and thunks
- Example: `src/store/messages/` contains messagesSlice, messagesSelectors, messagesThunks
- Thunk pattern: `createAsyncThunk` with typed responses and error handling
- Selector pattern: Memoized selectors with `createSelector` for derived data

**Real-time Subscriptions** (src/hooks/useMessages.ts):

```typescript
// Pattern: Custom hook with Supabase Realtime
const subscription = supabase
  .channel('messages')
  .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages' }, payload =>
    dispatch(addMessage(payload.new)),
  )
  .subscribe();

// Cleanup: useEffect return function
return () => {
  subscription.unsubscribe();
};
```

**Optimistic Updates**:

- Pattern: Dispatch optimistic update → API call → Confirm/rollback
- Example: messagesSlice uses `addMessage` before API confirmation
- Error handling: Rollback on failure with user notification

**Redux Persist**:

- Pattern: Selective persistence with AsyncStorage
- Configuration: Root store with persistConfig for specific reducers
- Usage: Messages, profile, preferences persisted; auth session expires

### Theme System (src/theme/)

**Material Design 3 with Dark Mode**:

- `index.ts`: Theme tokens with WCAG AA compliant colors
  - Light theme: `#007AFF` primary (iOS Blue, 4.5:1 contrast)
  - Dark theme: `#66B3FF` primary (8.5:1 contrast on dark surface)
  - Semantic colors: primary, secondary, error, surface, background
- `ThemeContext.tsx`: Theme provider with system detection
  - Pattern: React Context with AsyncStorage persistence
  - Features: System theme detection via `useColorScheme`
  - Auto-switching: Respects system preference when mode is 'system'
- `app/(tabs)/settings/theme.tsx`: Theme selection UI
  - Pattern: RadioButton group with three modes (light, dark, system)
  - Features: Loading state during theme change, accessibility labels

**Theme Usage Pattern**:

```typescript
import { useAppTheme } from '@/theme/ThemeContext'

const { theme, isDark, themeMode, setThemeMode } = useAppTheme()

// Use theme.colors for dynamic styling
<View style={{ backgroundColor: theme.colors.surface }}>
  <Text style={{ color: theme.colors.onSurface }}>Content</Text>
</View>
```

### Navigation Patterns (Expo Router)

**File-based Routing**:

- Directory structure defines routes automatically
- Groups: `(tabs)`, `(auth)`, `(onboarding)` for logical organization
- Dynamic routes: `[id].tsx` for parameterized paths
- Layout files: `_layout.tsx` for shared UI and navigation config

**Navigation Hooks**:

```typescript
import { useRouter, useLocalSearchParams } from 'expo-router';

// Navigate programmatically
const router = useRouter();
router.push('/profile/edit');
router.replace('/auth/login');
router.back();

// Access route parameters
const { id } = useLocalSearchParams<{ id: string }>();
```

**Deep Linking**:

- Pattern: URL scheme configured in app.json
- Format: `volvox://app/(tabs)/profile/edit`
- Automatic handling by Expo Router

### Accessibility Patterns

**WCAG 2.1 AA Compliance**:

- Minimum touch targets: 44x44 pixels (verified in accessibility.spec.ts)
- Color contrast: 4.5:1 for normal text, 3:1 for large text
- Screen reader support: aria-label, accessibilityLabel, accessibilityRole
- Keyboard navigation: Focus indicators, tab order, keyboard shortcuts

**Screen Reader Testing**:

- iOS VoiceOver: Manual testing checklist (**tests**/voiceover-testing-checklist.md)
- Android TalkBack: Manual testing checklist (**tests**/talkback-testing-checklist.md)
- Critical flows: Auth, onboarding, matches, connections, messages, sobriety, profile

**Accessibility Props Pattern**:

```typescript
<TouchableOpacity
  accessibilityLabel="Send message"
  accessibilityRole="button"
  accessibilityHint="Double tap to send the message"
>
  <Icon name="send" />
</TouchableOpacity>
```

### Testing Patterns

**E2E Testing with Playwright** (**tests**/\*.spec.ts):

- 9 comprehensive test suites covering all user flows
- Patterns: Login helper, navigation helpers, element verification
- Cross-browser: Chromium (default), Firefox, WebKit
- Accessibility: Automated WCAG AA validation in accessibility.spec.ts
- Dark mode: Comprehensive theming tests in dark-mode.spec.ts

**Test Organization**:

```
__tests__/
├── *.spec.ts           # Playwright E2E tests (excluded from Jest)
├── components/         # Component unit tests (Jest)
├── store/             # Redux state tests (Jest)
└── services/          # Service layer tests (Jest)
```

**E2E Test Pattern**:

```typescript
test.describe('Feature Flow', () => {
  test.beforeEach(async ({ page }) => {
    await login(page); // Helper function
  });

  test('User can complete action', async ({ page }) => {
    await page.click('[data-testid="action-button"]');
    await expect(page.locator('[data-testid="success"]')).toBeVisible();
  });
});
```

### Performance Patterns

**Image Lazy Loading**:

- Pattern: React Native Paper Avatar with loading prop
- Optimization: Only load images when components are visible
- Fallback: Placeholder initials for missing avatars

**List Virtualization**:

- Pattern: FlatList with optimized props
- Props: `removeClippedSubviews`, `maxToRenderPerBatch`, `windowSize`
- Use case: Messages list, connections list, matches list

**Redux Persist Configuration**:

- Pattern: Selective persistence to reduce AsyncStorage load
- Persist: User profile, preferences, non-sensitive cached data
- Don't persist: Auth tokens (use Supabase session), temporary UI state

**Skeleton Screens**:

- Pattern: Loading placeholders that match final content structure
- Implementation: React Native Paper Skeleton with animated wave
- Use cases: Profile loading, list loading, card loading

### Known Issues

**Pre-existing Test Failures** (Documented in claudedocs/pre-existing-test-issues.md):

- 7 failing unit test suites (pre-existing, not related to Phase 10 work)
- 456 TypeScript errors in old test files
- 78 lint warnings
- Supabase functions not included in tsconfig.json
- All new Phase 10 code is working correctly and type-safe

### Next Steps

- T149: Verify all acceptance scenarios from spec.md pass
- T150: Run bundle size analysis and verify targets met
- Address pre-existing test issues in separate maintenance task
- Prepare for feature branch merge to main
